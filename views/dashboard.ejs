<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Netigo Shareholder Dashboard</title>
  <link rel="icon" type="image/png" href="/netigo-logo.png">
  <link rel="apple-touch-icon" href="/netigo-logo.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/gridstack@10.0.1/dist/gridstack.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/gridstack@10.0.1/dist/gridstack-all.js"></script>
</head>

<body class="dashboard-body">

  <nav class="sidebar" id="sidebar">
    <div class="sidebar-logo">
      <img src="/netigo-logo.png" alt="Netigo Logo" style="width: 40px; height: 40px; object-fit: contain;">
      <h2>Netigo Shareholder Dashboard</h2>
      <button class="hamburger-btn close-sidebar"
        onclick="document.getElementById('sidebar').classList.remove('active')">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    <button class="sidebar-toggle" id="sidebarToggle" title="Toggle Sidebar">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M15 18l-6-6 6-6" />
      </svg>
    </button>
    <div class="sidebar-menu">
      <a href="/" class="menu-item active">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
          <polyline points="9 22 9 12 15 12 15 22"></polyline>
        </svg>
        <span>Dashboard</span>
      </a>

      <a href="/admin" class="menu-item">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
        </svg>
        <span>Admin Profile</span>
      </a>

      <% if (user.role==='superadmin' ) { %>
        <a href="/superadmin" class="menu-item">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
          </svg>
          <span>Superadmin</span>
        </a>
        <% } %>

          <div class="online-section">
            <p class="section-title">Live Tracking</p>
            <div id="online-users-list">
              <!-- Injected via JS -->
            </div>
          </div>

          <a href="#" class="menu-item" onclick="document.getElementById('aboutModal').classList.add('active');"
            style="margin-top: auto;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="16" x2="12" y2="12"></line>
              <line x1="12" y1="8" x2="12.01" y2="8"></line>
            </svg>
            <span>About / What's New</span>
          </a>

          <a href="/logout" class="menu-item logout-btn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
              <polyline points="16 17 21 12 16 7"></polyline>
              <line x1="21" y1="12" x2="9" y2="12"></line>
            </svg>
            <span>Logout</span>
          </a>
    </div>
  </nav>

  <main class="main-content">
    <header class="topbar">
      <div class="topbar-header">
        <button class="hamburger-btn" onclick="document.getElementById('sidebar').classList.add('active')">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
          </svg>
        </button>
        <div class="greeting">
          <h1>Overview</h1>
          <p>Welcome back, <span class="highlight">
              <%= user.username %>
            </span></p>
        </div>
      </div>
      <div class="topbar-actions">
        <a href="/api/export" class="btn-primary export-btn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="7 10 12 15 17 10"></polyline>
            <line x1="12" y1="15" x2="12" y2="3"></line>
          </svg>
          Export Transactions
        </a>
        <button class="btn-primary" id="openModalBtn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
          New Transaction
        </button>
      </div>
    </header>

    <section class="stats-grid">
      <div class="stat-card balance-card">
        <div class="stat-icon">₹</div>
        <div class="stat-info">
          <p>Total Balance</p>
          <h3 id="balance">₹0.00</h3>
        </div>
      </div>
      <div class="stat-card investment-card">
        <div class="stat-icon">↑</div>
        <div class="stat-info">
          <p>Total Investments</p>
          <h3 id="investment">₹0.00</h3>
        </div>
      </div>
      <div class="stat-card income-card">
        <div class="stat-icon">+</div>
        <div class="stat-info">
          <p>Gross Profit</p>
          <h3 id="income">₹0.00</h3>
        </div>
      </div>
      <div class="stat-card expense-card">
        <div class="stat-icon">−</div>
        <div class="stat-info">
          <p>Total Expenses</p>
          <h3 id="expense">₹0.00</h3>
        </div>
      </div>
      <div class="stat-card"
        style="background: linear-gradient(135deg, rgba(6,182,212,0.1), rgba(6,182,212,0.03)); border-left: 4px solid #06b6d4;">
        <div class="stat-icon" style="color:#06b6d4;">⇆</div>
        <div class="stat-info">
          <p>Net Profit</p>
          <h3 id="netProfit" style="color:#06b6d4;">₹0.00</h3>
        </div>
      </div>
      <div class="stat-card"
        style="background: linear-gradient(135deg, rgba(245,158,11,0.1), rgba(245,158,11,0.03)); border-left: 4px solid #f59e0b;">
        <div class="stat-icon" style="color:#f59e0b;">★</div>
        <div class="stat-info">
          <p>Company Valuation</p>
          <h3 id="companyValuation" style="color:#f59e0b;">₹0.00</h3>
        </div>
      </div>
    </section>

    <div style="display: flex; justify-content: flex-end; margin-bottom: 20px; gap: 12px;" id="layoutControls">
      <button class="btn-edit-layout" id="editLayoutBtn" onclick="toggleEditLayout()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 20h9"></path>
          <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
        </svg>
        Edit Dashboard Layout
      </button>
      <button class="btn-save-layout" id="saveLayoutBtn" onclick="toggleEditLayout()" style="display: none;">
        Save Custom Layout
      </button>
      <button class="btn-reset-layout" id="resetLayoutBtn" onclick="resetGrid()" style="display: none;">
        Reset Default Widgets
      </button>
    </div>

    <section class="grid-stack" id="main-grid">
      <!-- Chart Widget -->
      <div class="grid-stack-item" gs-id="chart" gs-x="0" gs-y="0" gs-w="4" gs-h="5" gs-min-w="3" gs-min-h="4">
        <div class="grid-stack-item-content">
          <div class="card chart-card" style="height: 100%; display: flex; flex-direction: column;">
            <h3>Financial Analytics</h3>
            <div class="chart-container" style="flex: 1;">
              <canvas id="chart"></canvas>
            </div>
          </div>
        </div>
      </div>

      <!-- Recurring Costs Widget -->
      <div class="grid-stack-item" gs-id="recurring" gs-x="4" gs-y="0" gs-w="8" gs-h="5" gs-min-w="5" gs-min-h="5">
        <div class="grid-stack-item-content">
          <div class="card recent-card" style="height: 100%; display: flex; flex-direction: column;">
            <div class="card-header"
              style="justify-content: space-between; align-items: center; border-bottom: 2px solid var(--border-color); padding-bottom: 15px; margin-bottom: 15px;">
              <div>
                <h3 style="margin-bottom: 5px;">Recurring Expenses of the company</h3>
                <p style="font-size: 13px; color: var(--text-muted); margin: 0;">Recurring Running Costs</p>
              </div>
              <select id="recurringTimeframe" class="btn-secondary"
                style="background: var(--bg-secondary); border: 1px solid var(--border-color); color: var(--text-main); font-weight: 500;"
                onchange="renderRecurringCosts()">
                <option value="monthly" selected>Monthly Overview</option>
                <option value="weekly">Weekly Overview</option>
                <option value="yearly">Yearly Overview</option>
                <option value="daily">Daily Overview</option>
              </select>
            </div>

            <div class="stat-info"
              style="margin-bottom: 20px; padding: 15px; background: rgba(239, 68, 68, 0.05); border-radius: 12px; border-left: 4px solid var(--color-expense);">
              <p
                style="color: var(--text-muted); font-size: 13px; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px;">
                Projected <span id="projectedLabel">Monthly</span> Overhead</p>
              <h2 id="projectedTotal" style="color: var(--color-expense); font-size: 28px; margin: 0;">₹0.00</h2>
            </div>

            <div style="flex: 1; overflow-y: auto; max-height: 250px; padding-right: 5px;" id="recurringList">
              <!-- Injected via JS -->
            </div>

            <button class="btn-primary"
              style="margin-top: 15px; width: 100%; justify-content: center; background: var(--bg-secondary); border: 1px dashed var(--text-muted); color: var(--text-main);"
              onclick="openAddRecurringModal()">
              <span style="font-size: 18px; margin-right: 5px;">+</span> Add Custom Recurring Cost
            </button>
          </div>
        </div>
      </div>

      <!-- Recent Transactions Widget -->
      <div class="grid-stack-item" gs-id="recent" gs-x="0" gs-y="5" gs-w="8" gs-h="4" gs-min-w="5" gs-min-h="3">
        <div class="grid-stack-item-content">
          <div class="card recent-card" style="height: 100%; display: flex; flex-direction: column;">
            <div class="card-header">
              <h3>Recent Transactions</h3>
            </div>
            <div class="table-container" style="flex: 1;">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>Type</th>
                    <th>Category</th>
                    <th>Amount</th>
                    <th>Date</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="table">
                  <!-- Injected via JS -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- WHMCS Orders Widget -->
      <div class="grid-stack-item" gs-id="whmcs-orders" gs-x="0" gs-y="9" gs-w="8" gs-h="4" gs-min-w="5" gs-min-h="3">
        <div class="grid-stack-item-content">
          <div class="card recent-card" style="height: 100%; display: flex; flex-direction: column;">
            <div class="card-header" style="justify-content: space-between;">
              <h3 style="display:flex; align-items:center; gap:8px;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--color-income)"
                  stroke-width="2">
                  <path
                    d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z">
                  </path>
                  <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                  <line x1="12" y1="22.08" x2="12" y2="12"></line>
                </svg>
                WHMCS Paid Orders
              </h3>
              <span
                style="font-size:12px; color:var(--text-muted); background:var(--bg-secondary); padding:4px 10px; border-radius:12px;">Auto-Synced</span>
            </div>
            <div class="table-container" style="flex: 1;">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>Client</th>
                    <th>Invoice Detail</th>
                    <th>Amount</th>
                    <th>Date</th>
                  </tr>
                </thead>
                <tbody id="whmcsTable">
                  <!-- Injected via JS -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Notes / Todo Widget -->
      <div class="grid-stack-item" gs-id="notes" gs-x="8" gs-y="5" gs-w="4" gs-h="4" gs-min-w="3" gs-min-h="4"
        style="position:relative;">
        <button id="addNoteTileBtn" onclick="showAddTileMenu()" title="Add separate tile"
          style="display:none;align-items:center;justify-content:center;width:36px;height:36px;background:var(--color-income);border:2px solid var(--bg-card);color:#fff;border-radius:50%;font-size:22px;cursor:pointer;line-height:1;transition:all 0.2s;position:absolute;top:-12px;left:-12px;z-index:20;box-shadow:0 4px 12px rgba(16,185,129,0.4);">+</button>
        <div class="grid-stack-item-content">
          <div class="card recent-card" style="height: 100%; display: flex; flex-direction: column;">
            <div class="card-header"
              style="flex-direction: column; align-items: stretch; border-bottom: 1px solid var(--border-light); padding-bottom: 15px; margin-bottom: 15px; gap: 12px;">
              <h3 style="margin: 0;">Team Notes &amp; Tasks</h3>
              <select id="notesViewSelect" class="btn-secondary" onchange="switchNotesTab(this.value)"
                style="width: 100%; padding: 8px 12px; font-size: 14px; border-radius: 8px; font-family: inherit; border: 1px solid var(--border-color); background: var(--bg-secondary);">
                <option value="global">Global Tasks</option>
                <option value="personal">Personal Tasks</option>
                <option value="completed">Completed Archive</option>
              </select>
            </div>

            <div style="flex: 1; overflow-y: auto; padding-right: 5px; margin-bottom: 15px;" id="notesList">
              <!-- Injected via JS -->
            </div>

            <button class="btn-primary" onclick="openAddTaskModal()"
              style="width: 100%; justify-content: center; padding: 12px; font-size: 15px; border-radius: 12px;">
              Add Task
            </button>
          </div>
        </div>
      </div>

      <!-- Revenue Timeline Widget -->
      <div class="grid-stack-item" gs-id="revenue-timeline" gs-x="0" gs-y="13" gs-w="8" gs-h="6" gs-min-w="5"
        gs-min-h="5">
        <div class="grid-stack-item-content">
          <div class="card recent-card" style="height: 100%; display: flex; flex-direction: column;">
            <div class="card-header"
              style="flex-wrap: wrap; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-light); padding-bottom: 12px; margin-bottom: 12px; gap: 8px;">
              <h3 style="margin: 0;">Revenue Timeline</h3>
              <div style="display:flex; gap: 8px; align-items: center; flex-wrap:wrap;">
                <select id="timelinePeriod" class="btn-secondary" onchange="loadRevenueTimeline()"
                  style="background: var(--bg-secondary); border: 1px solid var(--border-color); color: var(--text-main); font-weight: 500; padding: 5px 10px; border-radius: 8px; font-size: 13px;">
                  <option value="daily">Daily</option>
                  <option value="weekly">Weekly</option>
                  <option value="monthly" selected>Monthly</option>
                  <option value="yearly">Yearly</option>
                  <option value="all">All Time</option>
                </select>
                <input type="date" id="timelineFrom" onchange="loadRevenueTimeline()"
                  style="background: var(--bg-secondary); border: 1px solid var(--border-color); color: var(--text-main); padding: 4px 8px; border-radius: 8px; font-size: 12px; font-family: inherit;">
                <span style="color:var(--text-muted);font-size:12px;">to</span>
                <input type="date" id="timelineTo" onchange="loadRevenueTimeline()"
                  style="background: var(--bg-secondary); border: 1px solid var(--border-color); color: var(--text-main); padding: 4px 8px; border-radius: 8px; font-size: 12px; font-family: inherit;">
                <div style="display:flex; align-items:center; gap:10px; margin-left:10px; width:150px;">
                  <span style="color:var(--text-muted);font-size:12px;">Divisions:</span>
                  <input type="range" id="timelineDivisions" min="1" max="20" value="5"
                    oninput="updateRevenueDivisions()" style="flex:1; cursor:pointer;" title="Adjust Y-Axis Divisions">
                </div>
              </div>
            </div>
            <div class="chart-container" style="flex: 1; min-height: 200px;">
              <canvas id="revenueChart"></canvas>
            </div>
          </div>
        </div>
      </div>

      <!-- Investor Breakdown Widget -->
      <div class="grid-stack-item" gs-id="investors" gs-x="8" gs-y="9" gs-w="4" gs-h="6" gs-min-w="3" gs-min-h="4">
        <div class="grid-stack-item-content">
          <div class="card recent-card" style="height: 100%; display: flex; flex-direction: column;">
            <div class="card-header"
              style="border-bottom: 1px solid var(--border-light); padding-bottom: 12px; margin-bottom: 12px; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:8px;">
              <h3 style="margin: 0;">Investor Ownership</h3>
              <div style="display:flex; gap:8px; align-items:center;">
                <select onchange="switchInvestorChartMode(this.value)"
                  style="background:var(--bg-secondary);border:1px solid var(--border-light);border-radius:6px;color:var(--text-main);padding:5px 8px;font-size:11px;font-family:Outfit;cursor:pointer;">
                  <option value="ownership" selected>Ownership</option>
                  <option value="investment">Investment</option>
                  <option value="profit">Profit Sharing</option>
                </select>
                <button onclick="openAddInvestorModal()" class="btn-primary"
                  style="padding:5px 12px;font-size:11px;border-radius:6px;gap:4px;">
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <line x1="12" y1="5" x2="12" y2="19" />
                    <line x1="5" y1="12" x2="19" y2="12" />
                  </svg>
                  Add Investor
                </button>
              </div>
            </div>
            <div class="chart-container" style="height: 180px; margin-bottom: 15px;">
              <canvas id="investorChart"></canvas>
            </div>
            <div style="flex: 1; overflow-y: auto; padding-right: 5px;" id="investorList">
              <!-- Injected via JS -->
            </div>
          </div>
        </div>
      </div>

      <!-- Profit Trend Widget -->
      <div class="grid-stack-item" gs-id="profit" gs-x="0" gs-y="19" gs-w="12" gs-h="6" gs-min-w="6" gs-min-h="5">
        <div class="grid-stack-item-content">
          <div class="card recent-card" style="height: 100%; display: flex; flex-direction: column;">
            <div class="card-header"
              style="flex-wrap: wrap; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-light); padding-bottom: 12px; margin-bottom: 12px; gap: 8px;">
              <h3 style="margin: 0;">Profit Trend</h3>
              <div style="display:flex; gap: 8px; align-items: center; flex-wrap:wrap;">
                <select id="profitPeriod" class="btn-secondary" onchange="loadProfitTrend()"
                  style="background: var(--bg-secondary); border: 1px solid var(--border-color); color: var(--text-main); font-weight: 500; padding: 5px 10px; border-radius: 8px; font-size: 13px;">
                  <option value="daily">Daily</option>
                  <option value="weekly" selected>Weekly</option>
                  <option value="monthly">Monthly</option>
                  <option value="yearly">Yearly</option>
                  <option value="all">All Time</option>
                </select>
                <input type="date" id="profitFrom" onchange="loadProfitTrend()"
                  style="background: var(--bg-secondary); border: 1px solid var(--border-color); color: var(--text-main); padding: 4px 8px; border-radius: 8px; font-size: 12px; font-family: inherit;">
                <span style="color:var(--text-muted);font-size:12px;">to</span>
                <input type="date" id="profitTo" onchange="loadProfitTrend()"
                  style="background: var(--bg-secondary); border: 1px solid var(--border-color); color: var(--text-main); padding: 4px 8px; border-radius: 8px; font-size: 12px; font-family: inherit;">
                <div style="display:flex; align-items:center; gap:10px; margin-left:10px; width:150px;">
                  <span style="color:var(--text-muted);font-size:12px;">Divisions:</span>
                  <input type="range" id="profitDivisions" min="1" max="20" value="5" oninput="updateProfitDivisions()"
                    style="flex:1; cursor:pointer;" title="Adjust Y-Axis Divisions">
                </div>
              </div>
            </div>
            <div class="chart-container" style="flex: 1; min-height: 200px;">
              <canvas id="profitChart"></canvas>
            </div>
          </div>
        </div>
      </div>

    </section>
  </main>

  <!-- Add Transaction Modal -->
  <div class="modal-overlay" id="transactionModal">
    <div class="modal card">
      <div class="modal-header">
        <h3>Add Transaction</h3>
        <button class="close-modal" id="closeModalBtn">✕</button>
      </div>
      <form id="addForm">
        <div class="input-group">
          <label>Transaction Type</label>
          <select name="type" required>
            <option value="investment">Investment (Capital In)</option>
            <option value="income">Earnings (Revenue)</option>
            <option value="expense">Expense (Outflow)</option>
          </select>
        </div>
        <div class="input-group" id="investorGroup" style="display:none;">
          <label>Investor Name</label>
          <div style="display: flex; gap: 10px;">
            <select name="investor_name" id="investorSelect" style="flex:1;">
              <!-- Injected via JS -->
            </select>
            <button type="button" class="btn-primary" id="newInvestorBtn" style="width: auto;">+</button>
          </div>
        </div>
        <div class="input-group">
          <label>Category / Source</label>
          <div style="display: flex; gap: 10px;">
            <select name="category" id="categorySelect" required style="flex:1;">
              <!-- Injected via JS -->
            </select>
            <button type="button" class="btn-primary" id="newCategoryBtn" style="width: auto;">+</button>
          </div>
        </div>
        <div class="input-group">
          <label>Amount (₹)</label>
          <input name="amount" type="number" step="0.01" placeholder="0.00" required>
        </div>
        <div class="input-group">
          <label>Transaction Date</label>
          <input name="date" id="transactionDate" type="date" required>
        </div>
        <div class="input-group">
          <label>Note (Optional)</label>
          <input name="note" placeholder="Add details...">
        </div>
        <button type="submit" class="btn-primary w-100">Save Record</button>
      </form>
    </div>
  </div>

  <!-- Delete Verification Modal -->
  <div class="modal-overlay" id="deleteModal">
    <div class="modal card">
      <div class="modal-header">
        <h3 style="color: var(--color-expense);">Secure Deletion</h3>
        <button class="close-modal" onclick="closeDeleteModal()">✕</button>
      </div>
      <form id="deleteForm">
        <p style="color: var(--text-muted); margin-bottom: 20px; font-size: 14px;">This action cannot be undone. Please
          confirm.</p>
        <input type="hidden" id="deleteId">
        <input type="hidden" id="deleteType" value="transaction">
        <div class="input-group">
          <label>Please type "DELETE" to confirm</label>
          <input name="confirm_text" type="text" placeholder="DELETE" required autocomplete="off">
        </div>
        <button type="submit" class="btn-primary w-100" style="background: var(--color-expense);">Delete Record</button>
      </form>
    </div>
  </div>

  <!-- About / What's New Modal -->
  <div class="modal-overlay" id="aboutModal">
    <div class="modal card">
      <div class="modal-header">
        <h3>About Netigo Shareholder Dashboard</h3>
        <button class="close-modal"
          onclick="document.getElementById('aboutModal').classList.remove('active')">✕</button>
      </div>
      <div style="margin-bottom: 20px;">
        <p style="color: var(--text-main); font-size: 16px; margin-bottom: 5px;"><strong>Company:</strong> Netigo</p>
        <p style="color: var(--text-muted); font-size: 14px;"><strong>Developed and Managed by:</strong> Kaveesh Krishna
          Pandey</p>
      </div>

      <a href="/updates"
        style="display: block; background: rgba(139, 92, 246, 0.1); border-left: 4px solid var(--color-investment); padding: 15px; border-radius: 8px; text-decoration: none; transition: 0.2s;">
        <h4 style="color: var(--color-investment); margin-bottom: 5px;">What's New →</h4>
        <p style="color: var(--text-muted); font-size: 14px; margin: 0;">Click here to view the full changelog and
          update history.</p>
      </a>
    </div>
  </div>

  <!-- Add Recurring Cost Modal -->
  <div class="modal-overlay" id="recurringModal">
    <div class="modal card">
      <div class="modal-header">
        <h3 id="recurringModalTitle">Add Recurring Cost</h3>
        <button class="close-modal"
          onclick="document.getElementById('recurringModal').classList.remove('active')">✕</button>
      </div>
      <form id="recurringForm" onsubmit="saveRecurringCost(event)">
        <div class="input-group">
          <label>Cost Name</label>
          <input name="name" id="reqName" type="text" placeholder="e.g. WHMCS License" required>
        </div>
        <div class="input-group">
          <label>Amount (₹)</label>
          <input name="amount" id="reqAmount" type="number" step="0.01" placeholder="e.g. 500" required>
        </div>
        <div class="input-group">
          <label>Billing Cycle</label>
          <select name="billing_cycle" id="reqCycle" required>
            <option value="monthly" selected>Monthly</option>
            <option value="yearly">Yearly</option>
            <option value="weekly">Weekly</option>
            <option value="daily">Daily</option>
          </select>
        </div>
        <button type="submit" class="btn-primary w-100" style="background: var(--color-expense);">Save Cost</button>
      </form>
    </div>
  </div>

  <!-- Add Task Modal -->
  <div class="modal-overlay" id="addTaskModal">
    <div class="modal card">
      <div class="modal-header">
        <h3>Create New Task</h3>
        <button class="close-modal" id="closeTaskBtn">✕</button>
      </div>
      <form id="addTaskForm" onsubmit="event.preventDefault(); addNote();">
        <div class="input-group">
          <label>Task Type</label>
          <select id="modalNoteGlobal" class="note-select-field" onchange="toggleModalGlobalOptions()"
            style="padding: 12px; height: auto;">
            <option value="false">Personal Task</option>
            <option value="true">Global Team Task</option>
          </select>
        </div>
        <div class="input-group">
          <label>Task Title</label>
          <input type="text" id="modalNoteInput" class="note-input-field" placeholder="What needs to be done?" required>
        </div>
        <div class="input-group">
          <label>Description (Optional)</label>
          <textarea id="modalNoteDescription" class="note-input-field" placeholder="Add more details..." rows="3"
            style="resize: vertical; font-family: inherit; font-size: 14px;"></textarea>
        </div>
        <div class="input-group">
          <label>Deadline (Optional)</label>
          <input type="date" id="modalNoteDeadline" class="note-input-field">
        </div>
        <div id="modalGlobalOptions" style="display: none; flex-direction: column; gap: 15px;">
          <div class="input-group">
            <label>Assignee</label>
            <select id="modalNoteAssignee" class="note-select-field" style="padding: 12px; height: auto;">
              <option value="all">Assign to Everyone (ALL)</option>
              <% if (typeof allUsers !=='undefined' ) { %>
                <% allUsers.forEach(u=> { %>
                  <option value="<%= u.id %>">
                    <%= u.username %>
                  </option>
                  <% }) %>
                    <% } %>
            </select>
          </div>
        </div>
        <button type="submit" class="btn-primary"
          style="width: 100%; justify-content: center; margin-top: 10px; padding: 12px; font-size: 15px;">Create
          Task</button>
      </form>
    </div>
  </div>

  <!-- View Task Modal -->
  <div class="modal-overlay" id="viewTaskModal">
    <div class="modal card" style="max-width: 500px;">
      <div class="modal-header"
        style="border-bottom: 1px solid var(--border-light); padding-bottom: 15px; margin-bottom: 15px;">
        <h3 id="viewTaskTitle" style="word-wrap: break-word; word-break: break-all; line-height: 1.4; max-width: 90%;">
          Task Details</h3>
        <button class="close-modal" id="closeViewTaskBtn">✕</button>
      </div>
      <div style="display: flex; flex-direction: column; gap: 15px;">
        <div id="viewTaskMeta" style="display: flex; gap: 10px; flex-wrap: wrap; font-size: 12px;"></div>
        <div
          style="background: rgba(0,0,0,0.2); border-radius: 8px; padding: 15px; border: 1px solid var(--border-light);">
          <p id="viewTaskDescription"
            style="color: var(--text-main); font-size: 14px; white-space: pre-wrap; line-height: 1.6; margin: 0; min-height: 60px;">
          </p>
        </div>
        <div id="viewTaskDeadlineContainer"
          style="display: none; align-items: center; gap: 8px; color: var(--color-expense); font-size: 13px; font-weight: 500; background: rgba(239, 68, 68, 0.05); padding: 10px 15px; border-radius: 8px;">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line x1="3" y1="10" x2="21" y2="10"></line>
          </svg>
          <span id="viewTaskDeadline"></span>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Sidebar Toggle Logic
    const initSidebar = () => {
      const sidebar = document.getElementById('sidebar');
      const mainContent = document.querySelector('.main-content');
      const toggleBtn = document.getElementById('sidebarToggle');

      const isCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
      if (isCollapsed) {
        sidebar.classList.add('collapsed');
        if (mainContent) mainContent.classList.add('expanded');
      }

      if (toggleBtn) {
        toggleBtn.addEventListener('click', () => {
          sidebar.classList.toggle('collapsed');
          const collapsedNow = sidebar.classList.contains('collapsed');
          localStorage.setItem('sidebarCollapsed', collapsedNow);
          if (mainContent) {
            mainContent.classList.toggle('expanded', collapsedNow);
          }
        });
      }
    };
    document.addEventListener('DOMContentLoaded', initSidebar);
  </script>

  <script src="/dashboard.js"></script>
</body>

</html>